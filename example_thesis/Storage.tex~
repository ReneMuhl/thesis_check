\chapter{Storage-Möglichkeiten}

\input{ephemeral storage}



%persistent/Persistenz im Text verwenden
%Eigenschaften der Storage-Möglichkeiten nachgehen
%weitere Optionen/Einstellungsmöglichkeiten in nova.conf, cinder.conf und andere heraussuchen/untersuchen
%Verweise auf die Messdaten machen
Alle Storage-Varianten, die mit OpenStack erstellt werden, besitzen die folgende Eigenschaft: Zu einem Zeitpunkt ist ein Storage immer genau einer VM zugeordnet.

\section{Volume Storage}
Als Volume Storage wird ein Storage beschrieben, der mit der OpenStack Komponenten Cinder verwaltet wird. Mit Cinder kann man zunächst den Volume
Storage - die virtuelle block storage Festplatte unabhängig von einer Virtuellen Maschine erstellen. \\
%\vspace{1cm}
\newline
\Befehlsheader{Erstellen eines Cinder-Volumes}{cinder create --display-name volume\_01 20}
\vspace{.15cm}
\newline
\begin{tabular}{|c|l|}
  \hline
  \texttt{20} & \textit{Größe des Volumes in Gigabyte} \\
  \hline
  %volume-type für die Bachends
\end{tabular}
\vspace{.5cm}
\newline
\Befehlsheader{Liste aller Volumes (mit dem Hinzugefügtem)}{cinder list} \\
\lstset{
  basewidth=.54em
}
\begin{minipage}{\textwidth}
\begin{lstlisting}
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
| d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad | available |  volume_01   |  20  |     None    |  false   |             |
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
\end{lstlisting}
\end{minipage}
Nachdem man dieses Volume erstellt hat, kann man dieses einer Instanz zuweisen. Von diesem Zeitpunkt hat diese VM
exklusiven Zugriff auf den Datenspeicher. Bei der ersten Zuweisung ist zu beachten, dass das Volume zunächst mit einem Dateisystem formatiert werden sollte. \\
\vspace{.15cm}
\newline
\Befehlsheader{Liste aller verfügbaren virtuellen Maschinen}{nova list} \\
\lstset{
  basewidth=.635em
}
\begin{minipage}{\textwidth}
\begin{lstlisting}
+--------------------------------------+--------+--------+-------------------------------------+
| ID                                   |  Name  | Status | Networks                            |
+--------------------------------------+--------+--------+-------------------------------------+
| 1384d180-a663-4628-a3a6-3c186c4f1401 | VM_01  | ACTIVE | public=172.16.16.4, 192.168.128.250 |
+--------------------------------------+--------+--------+-------------------------------------+
\end{lstlisting}
\end{minipage}
\vspace{.15cm}
\newline
\Befehlsheader{Zuweisung eines Volumes zu einer VM}{nova volume-attach 1384d180-a663-4628-a3a6-3c186c4f1401 \\ d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad auto}
\vspace{1cm}
\newline
\begin{tabular}{|c|l|}
  \hline
  \texttt{1384d180-a663-4628-a3a6-3c186c4f1401} & \textit{ID des Servers, der das Volume erhält} \\ 	%oder erhalten wird?????
  \hline
  \texttt{d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad} & \textit{ID des Volumes} \\
  \hline
  \texttt{auto} & \textit{Name des devices, auch möglich: /dev/vdc} \\
  \hline
\end{tabular}
\vspace{1cm}
\newline
\Befehlsheader{Liste aller Volumes (nachdem das Volume einer VM zugewiesen wurde)}{cinder list}
\newline
\lstset{
  basewidth=.45em
}
\begin{minipage}{\textwidth}
\begin{lstlisting}
+--------------------------------------+--------+--------------+------+-------------+----------+--------------------------------------+
|                  ID                  | Status | Display Name | Size | Volume Type | Bootable |             Attached to              |
+--------------------------------------+--------+--------------+------+-------------+----------+--------------------------------------+
| d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad | in-use |  volume_01   |  20  |     None    |  false   | 1384d180-a663-4628-a3a6-3c186c4f1401 |
+--------------------------------------+--------+--------------+------+-------------+----------+--------------------------------------+
\end{lstlisting}
\end{minipage}
\vspace{.15cm}
\newline
\Befehlsheader{Entziehen eines Volumes von einer VM}{nova volume-detach 1384d180-a663-4628-a3a6-3c186c4f1401 \\ d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad}
\vspace{.15cm}
\newline
\begin{tabular}{|c|l|}
  \hline
  \texttt{1384d180-a663-4628-a3a6-3c186c4f1401} & \textit{ID des Servers, der das Volume erhält} \\
  \hline
  \texttt{d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad} & \textit{ID des Volumes} \\
  \hline
\end{tabular}
\vspace{.5cm}
\newline
\Befehlsheader{Liste aller Volumes (nachdem das Volume der Instanz wieder entzogen wurde)}{cinder list} \\
\lstset{
  basewidth=.54em
}
\begin{minipage}{\textwidth}
\begin{lstlisting}
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
|                  ID                  |   Status  | Display Name | Size | Volume Type | Bootable | Attached to |
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
| d12bcd7c-0fcb-4e07-a6f6-a4ade856cdad | available |  volume_01   |  20  |     None    |  false   |             |
+--------------------------------------+-----------+--------------+------+-------------+----------+-------------+
\end{lstlisting}
\end{minipage}
\vspace{.15cm}
\newline
Ein Volume kann jetzt wieder einer beliebigen virtuellen Maschine zugewiesen werden. Man kann sich diese Art von Storage
als eine Art externe Festplatte vorstellen.

\section{NFS - Network File System}
%Quellen: http://wiki.ubuntuusers.de/NFS
NFS meint hier Netzwerkprotokol von Sun Microsystems aus den 1980er Jahren, die Abgrenzung ist wichtig, da es für Cinder ebenfalls NFS als Backend zur Verfügung
steht und eine Verwechselung ausgeschlossen werden soll. Als Voraussetzung für natives NFS müssen sich der NFS-Server und die virtuelle Maschine als NFS-Client
in einem (gemeinsamen) Netzwerk befinden. Diese Storage-Möglichkeit hat gegenüber den bisher genannten Lösungen den Vorteil, dass mehreren Instanzen auf dieser
gleichzeitig Lesen und Schreiben können. Außerdem kann man über den NFS-Share Daten zwischen VM und physischen PCs austauschen. Die Deklaration
als NFS-Server geschieht durch die Installation von nfs-kernel-server.
\vspace{.15cm}
\newline
\Befehlsheader{Installation des NFS-Servers (debianbasierend)}{sudo apt-get install nfs-kernel-server}
\vspace{.15cm}
\newline
Anschließend muss man den lokalen Festplattenspeicher dem Netzwerk bereitstellen, indem man auf dem Server folgende Editierungen vornimmt: \\
\vspace{.15cm}
\newline
\Befehlsheader{/etc/exports}{/srv/shares     192.168.128.0/255.255.255.0(rw,async,no\_root\_squash,no\_subtree\_check)}
\vspace{.15cm}
\newline
chmod 777 /srv/shares \\
root:service nfs-kernel-server restart \\
Danach sollte dieser Storage für alle NFS-Clients im Netzwerk erreichbar sein. Der NFS-Client ist die VM, auf der die nachfolgenden
Einstellungen vorgenommen werden müssen: \\ 
\vspace{.15cm}
\newline
\Befehlsheader{Installation des NFS-Clients (debianbasierend)}{sudo apt-get install nfs-common}
\vspace{.15cm}
\newline
%Unterscheidung:
%einmal temporär:  mount .....
%oder dauerhaft/auch nach Neustart noch verfügbar: /etc/fstab, mount -a (um alle Einträge zu mounten)
Anschließend sollte noch das Netzlaufwerk gemountet werden: \\
\vspace{.15cm}
\newline
\Befehlsheader{/etc/fstab}{192.168.128.245:/srv/shares   /mnt     defaults,rw,nfsvers=3   0 0}
\vspace{.15cm}
\newline
\begin{tabular}{|c|l|}
  \hline
  \texttt{192.168.128.245} & \textit{IP-Adresse des NFS-Servers} \\ 
  \hline
  \texttt{/srv/shares} & \textit{Verzechnis das mit /etc/exports auf dem Server bereitgestellt wurde} \\
  \hline
  \texttt{/mnt} & \textit{Mount-Verzeichnis auf dem NFS-Client} \\
  \hline
\end{tabular}
\vspace{.15cm}
\newline
\Befehlsheader{mounten aller /etc/fstab-Einträge}{mount -a}
\vspace{.15cm}
\newline
Danach kann man überprüfen, ob der Datenspeicher des NFS-Server als lokale Ressource zur Verfügung steht. \\
Überprüfung mit mount Befehl
\vspace{.15cm}
\newline
\Befehlsheader{Anzeigen aller gemounteter Laufwerk}{mount}
\vspace{.15cm}
\newline
%Ausgabe anfügen???!!
Nachdem alle Einstellungen so vorgenommen wurden, können auf dem virtuellen Server Daten im Verzechnis \textit{/mnt} abgelegt werden.
Diese Daten werden dann per Network File System über das Netzwerk gesendet und auf dem Server geschrieben.

